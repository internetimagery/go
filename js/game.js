(function(){var t,e,n,r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};n=function(t,e,n,r,s){return this.setAttribute("style","margin-left:"+t+"%;margin-top:"+e+"%;width:"+n+"%;height:"+r+"%;"+s)},e=function(t,e){var r;return r=document.createElement("div"),r.setAttribute("class",t),r.resize=n,e.appendChild(r),r},t=function(){function t(t,n){var r,s,i,o,a,u,h,l,c,d,p,f,g,m,v,y,_,b,w,z,M,A,I,k;if(this.size=n,this.callbacks=[],this.stone_class=["empty","stone set black","stone set white","empty-black","empty-white"],this.board_state=[],this.size<2)throw"Board size not big enough.";for(o=100/(this.size-1),k=.9*o,A=.2*k,u=e("grid",t),h=.6*k,l=100-2*h,u.resize(h,h,l,l,"position:relative;"),t.appendChild(u),w=a=0,m=this.size;m>=0?m>a:a>m;w=m>=0?++a:--a)e("line-horiz",u).setAttribute("style","top:"+w*o+"%;");for(s=c=0,v=this.size;v>=0?v>c:c>v;s=v>=0?++c:--c)e("line-vert",u).setAttribute("style","left:"+s*o+"%;");for(this.sockets=[],I=[],this.size%2===1&&(r=Math.floor(this.size/2),I.push([r,r])),7<(y=this.size)&&13>y&&(I.push([2,2]),I.push([2,this.size-3]),I.push([this.size-3,2]),I.push([this.size-3,this.size-3])),13<=this.size&&(I.push([3,3]),I.push([3,this.size-4]),I.push([this.size-4,3]),I.push([this.size-4,this.size-4])),s=d=0,_=this.size;_>=0?_>d:d>_;s=_>=0?++d:--d)for(i=function(t){return function(){var e;return e=t.sockets.length,z.onclick=function(n){return t.placement_event(e)}}}(this),w=p=0,b=this.size;b>=0?b>p:p>b;w=b>=0?++p:--p){for(g=0,f=I.length;f>g;g++)M=I[g],M[0]===w&&M[1]===s&&(M=e("star",u),M.resize(w*o-.5*A,s*o-.5*A,A,A,"position:absolute;"));z=e("empty",u),z.player=0,z.resize(w*o-.5*k,s*o-.5*k,k,k,"position:absolute;"),i(),this.sockets.push(z),this.board_state.push(0)}}return t.prototype.register=function(t){return this.callbacks.push(t)},t.prototype.placement_event=function(t){var e,n,r,s,i;for(s=this.callbacks,i=[],n=0,r=s.length;r>n;n++)e=s[n],i.push(e(t));return i},t.prototype.place=function(t,e){if(t>Math.pow(this.size,2))throw"Requested position not within board size.";return this.board_state[t]=e},t.prototype.dump_state=function(){return this.board_state.slice(0)},t.prototype.load_state=function(t){if(t.length!==Math.pow(this.size,2))throw"Invalid State Size";return this.board_state=t.slice(0)},t.prototype.update=function(t){var e,n,r,s;for(s=[],n=e=0,r=this.sockets.length;r>=0?r>e:e>r;n=r>=0?++e:--e)this.board_state[n]!==this.sockets[n].player&&(this.sockets[n].setAttribute("class",this.stone_class[this.board_state[n]]),this.sockets[n].player=this.board_state[n]),0===this.sockets[n].player?s.push(this.sockets[n].setAttribute("class",this.stone_class[t+2])):s.push(void 0);return s},t.prototype.get_player=function(t){if(t>Math.pow(this.size,2))throw"Requested position not within board size.";return this.board_state[t]},t.prototype.get_surroundings=function(t){var e,n,r;return r={},e=t-1,n=e%this.size,n!==this.size-1&&n>=0&&(r.left=e),e=t+1,n=e%this.size,0!==n&&n<=this.size&&(r.right=e),e=t-this.size,e>=0&&(r.up=e),e=t+this.size,e<Math.pow(this.size,2)&&(r.down=e),r},t.prototype.get_connected_stones=function(t){var e,n,s,i,o,a;for(s=[t],i=this.get_player(t),a=[t];a.length>0;){t=a.pop(),o=this.get_surroundings(t);for(e in o)n=o[e],this.get_player(n)===i&&r.call(s,n)<0&&(s.push(n),a.push(n))}return s},t.prototype.get_liberties=function(t){var e,n,s,i,o,a,u;for(o=[],s=0,i=t.length;i>s;s++){a=t[s],u=this.get_surroundings(a);for(e in u)n=u[e],0===this.get_player(n)&&r.call(o,n)<0&&o.push(n)}return o},t.prototype.is_surrounded=function(t){var e,n,r;return r=this.get_player(t),0!==r?(e=this.get_connected_stones(t),n=this.get_liberties(e),!(n.length>0)):!1},t}(),this.Board=t}).call(this),function(){var t,e,n,r,s;s=function(){var t;return t=document.getElementById("short-link"),t.href="https://tinyurl.com/api-create.php?url="+encodeURIComponent(window.location.href)},e=function(t){var e,n,r,s;for(n=[document.getElementById("player-black"),document.getElementById("player-white")],r=0,s=n.length;s>r;r++)e=n[r],e.setAttribute("style","");return n[t].setAttribute("style","box-shadow: 0px 0px 3px 3px yellow;")},t=function(t,e){var n,r,s,i;if(0!==e.get_player(t)){for(n=e.get_connected_stones(t),i=[],r=0,s=n.length;s>r;r++)t=n[r],i.push(e.place(t,0));return i}},r=function(e,n,r,s){var i,o,a,u,h,l,c,d,p;if(null===n)return r.dump_state();if(0!==r.get_player(n))throw"Illegal Move: Space occupied.";r.place(n,e),i=!1,c=r.get_surroundings(n);for(o in c)p=c[o],r.get_player(p)!==e&&r.is_surrounded(p)&&(t(p,r),i=!0);if(l=r.dump_state(),i&&s){for(h=!0,a=u=0,d=l.length;d>=0?d>u:u>d;a=d>=0?++u:--u)if(l[a]!==s[a]){h=!1;break}if(h)throw"Illegal Move: Ko."}if(r.is_surrounded(n))throw"Illegal Move: Suicide.";return l},n=function(){var t,n,i,o,a,u,h,l,c,d,p,f;for(i=new Game_Data,o=[],f=window.location.href.split("#"),2===f.length&&f[1]?(console.log("!! LOADING GAME !!"),i.read_id(decodeURIComponent(f[1]))):(console.log("!! NEW GAME !!"),history.replaceState(0,"start",f[0]+"#"+i.write_id()),s()),t=new Board(document.getElementById("board"),i.board_size),l=document.getElementById("pass"),c=i.moves,a=0,u=c.length;u>a;a++)h=c[a],d=null===h?0===o.length?t.dump_state():o[o.length-2]:r(o.length%2+1,h,t,o[o.length-1]),o.push(d),window.document.title="Move "+o.length,i.current=o.length,p=f[0]+"#"+i.write_id(),0===i.current?history.replaceState(o.length,"Start",p):history.pushState(o.length,"Move "+i.current,p),s();return t.update(o.length%2+1),e(o.length%2),t.register(function(n){var a,u,h,l;if(i.current!==o.length)return alert("Cannot add move. The game has progressed past this point.");a=0===o.length?t.dump_state():o[o.length-1];try{return a=r(i.current%2+1,n,t,o[o.length-2]),o.push(a),i.current=o.length,i.add_move(n),history.pushState(o.length,"Move "+o.length,f[0]+"#"+i.write_id()),t.load_state(a),l=i.current%2,t.update(l+1),window.document.title="Move "+o.length,e(l),s()}catch(h){return u=h,t.load_state(a),alert(u)}}),l.onclick=function(e){return t.placement_event(null)},document.addEventListener("keypress",function(e){return"p"===e.key?t.placement_event(null):void 0}),window.addEventListener("popstate",function(n){if(h=parseInt(n.state),isNaN(h))throw"Invalid game state!";return console.log("Loaded game state "+h+"."),i.current=h,t.load_state(o[h-1]),t.update(h%2+1),window.document.title="Move "+h,e(h%2),s()}),n=document.getElementById("dropzone"),n.addEventListener("dragover",function(t){return t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}),n.addEventListener("drop",function(t){var e,n;return t.stopPropagation(),t.preventDefault(),e=t.dataTransfer.files,e[0]?(n=new FileReader,n.onload=function(t){var e,n,r;e=t.target.result;try{return i.load_sgf(e),window.location.assign(f[0]+"#"+i.write_id()),location.reload(!0)}catch(r){return n=r,alert("There was a problem loading the SGF."),console.error(n)}},n.readAsText(e[0])):void 0})},this.main=n}.call(this),function(){var t,e,n,r;r=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],e=function(t,e){var n,s;if("[]"===t)return null;if(s=r.indexOf(t[0])*e,n=r.indexOf(t[1]),-1===s||-1===n)throw"Bad Move "+t+".";return s+n},n=function(t,e){var n,s;return null===t?"[]":(s=r[Math.floor(t/e)],n=r[t%e],s.concat(n))},t=function(){function t(){this.mode=0,this.board_size=9,this.moves=[],this.current=0}return t.prototype.add_move=function(t){if(null!==t&&t>Math.pow(this.board_size,2))throw"Move is too large to fit on the board";return this.moves.push(t)},t.prototype.write_id=function(){var t,e,r;return r=("00"+this.board_size).slice(-2),e=function(){var e,r,s,i;for(s=this.moves,i=[],e=0,r=s.length;r>e;e++)t=s[e],i.push(n(t,this.board_size));return i}.call(this).slice(0,this.current).join(""),this.mode+r+e},t.prototype.read_id=function(t){var n,s,i,o,a,u,h,l,c;if(t.length>=3){if(console.log("Validating game data..."),u=parseInt(t[0]),isNaN(u))throw"Invalid Game Mode";if(n=parseInt(t.slice(1,3)),isNaN(n)||3>n||n>r.length)throw"Invalid Board Size. Sizes must be between 3 and "+r.length+".";if(c=t.slice(3),c.length%2!==0)throw"Possible corrupt game data...";for(c.length/2>973&&console.warn("Turn limit of 973 exceeded. Urls may not work on some browsers."),s=Math.pow(n,2),h=[],i=a=0,l=c.length/2;l>=0?l>a:a>l;i=l>=0?++a:--a){if(i*=2,o=e(c.slice(i,i+2),n),isNaN(o)||null!==o&&o>s)throw"Invalid Turn @ "+i/3+".";h.push(o)}return this.mode=u,this.board_size=n,this.moves=h,this.current=h.length,console.log("Valid!")}},t.prototype.load_sgf=function(t){var n,r,s,i,o,a,u,h,l,c,d,p,f,g,m;if(i=smartgamer(sgf_parse(t)),a=i.getGameInfo(),s=["B","W"],"1"!==a.GM)throw"Game file is not a game of GO.";if(l="0",r=parseInt(a.SZ),d=[],i.first(),p=i.node(),p.AB||p.AW)for(o=u=0,f=Math.max(p.AB.length||0,p.AW.length||0);f>=0?f>=u:u>=f;o=f>=0?++u:--u)n=p.AB[o],m=p.AW[o],n?d.push(e(n,r)):d.push(null),m?d.push(e(m,r)):d.push(null);for(o=h=0,g=i.totalMoves();g>=0?g>h:h>g;o=g>=0?++h:--h)i.next(),c=i.node()[s[o%2]],"[tt]"!==c&&c||(c="[]"),d.push(e(c,r));return this.mode=l,this.board_size=r,this.moves=d,this.current=d.length},t}(),this.Game_Data=t}.call(this),function(){this.sgf_parse=function(t){"use strict";var e,n,r,s,i,o;return s=void 0,i=void 0,e={},o=void 0,r=void 0,n=void 0,i={beginSequence:function(t){var n,r;return n="sequences",o||(o=e,n="gameTrees"),o.gameTrees&&(n="gameTrees"),r={parent:o},o[n]=o[n]||[],o[n].push(r),o=r,s(t.substring(1))},endSequence:function(t){return o=o.parent?o.parent:null,s(t.substring(1))},node:function(t){return r={},o.nodes=o.nodes||[],o.nodes.push(r),s(t.substring(1))},property:function(t){var e,i,o,a,u;if(o=void 0,e=t.match(/([^\\\]]|\\(.|\n|\r))*\]/),!e.length)throw new Error("malformed sgf");return e=e[0].length,u=t.substring(0,e),a=u.indexOf("["),i=u.substring(0,a),i||(i=n,Array.isArray(r[i])||(r[i]=[r[i]])),n=i,o=u.substring(a+1,u.length-1),i.length>2&&console.warn("SGF PropIdents should be no longer than two characters:",i),Array.isArray(r[i])?r[i].push(o):r[i]=o,s(t.substring(e))},unrecognized:function(t){return s(t.substring(1))}},(s=function(t){var n,r;return n=t.substring(0,1),r=void 0,n?(r="("===n?"beginSequence":")"===n?"endSequence":";"===n?"node":-1!==n.search(/[A-Z\[]/)?"property":"unrecognized",i[r](t)):e})(t)},this.generate=function(t){var e;return(e=function(t){var n;return n="",t.forEach(function(t){n+="(",t.nodes&&t.nodes.forEach(function(t){var e,r,s;e=";";for(s in t)t.hasOwnProperty(s)&&(r=t[s],Array.isArray(r)&&(r=r.join("][")),e+=s+"["+r+"]");n+=e}),t.sequences&&(n+=e(t.sequences)),n+=")"}),n})(t.gameTrees)}}.call(this),function(){this.smartgamer=function(t){"use strict";var e,n,r;return r=void 0,n=void 0,e=function(){this.init()},e.prototype={init:function(){t&&(this.game=t.gameTrees[0],this.reset())},load:function(e){t=e,this.init()},games:function(){return t.gameTrees},selectGame:function(e){if(!(e<t.gameTrees.length))throw new Error("the collection doesn't contain that many games");return this.game=t.gameTrees[e],this.reset(),this},reset:function(){return r=this.game,n=r.nodes[0],this.path={m:0},this},getSmartgame:function(){return t},variations:function(){var t,e;return r&&(e=r.nodes,t=e?e.indexOf(n):null,e)?t===e.length-1?r.sequences||[]:[]:void 0},next:function(t){var e,s;if(t=t||0,s=r.nodes,e=s?s.indexOf(n):null,null===e||e>=s.length-1){if(!r.sequences)return this;r=r.sequences[t]?r.sequences[t]:r.sequences[0],n=r.nodes[0],this.path[this.path.m]=t,this.path.m+=1}else n=s[e+1],this.path.m+=1;return this},previous:function(){var t,e;if(e=r.nodes,t=e?e.indexOf(n):null,delete this.path[this.path.m],t&&0!==t)n=e[t-1],this.path.m-=1;else{if(!r.parent||r.parent.gameTrees)return this;r=r.parent,r.nodes?(n=r.nodes[r.nodes.length-1],this.path.m-=1):n=null}return this},last:function(){var t;for(t=this.totalMoves();this.path.m<t;)this.next();return this},first:function(){return this.reset(),this},goTo:function(t){var e,r,s;for("string"==typeof t?t=this.pathTransform(t,"object"):"number"==typeof t&&(t={m:t}),this.reset(),r=n,e=0;e<t.m&&r;)s=t[e]||0,r=this.next(s),e+=1;return this},getGameInfo:function(){return this.game.nodes[0]},node:function(){return n},totalMoves:function(){var t,e;for(t=this.game,e=0;t;)e+=t.nodes.length,t=t.sequences?t.sequences[0]:null;return e-1},comment:function(t){return"undefined"==typeof t?n.C?n.C.replace(/\\([\\:\]])/g,"$1"):"":void(n.C=t.replace(/[\\:\]]/g,"\\$&"))},translateCoordinates:function(t){var e,n;return e="abcdefghijklmnopqrst",n=[],n[0]=e.indexOf(t.substring(0,1)),n[1]=e.indexOf(t.substring(1,2)),n},pathTransform:function(t,e,n){var r,s,i;return r=void 0,i=function(t){var e,s;if("string"==typeof t)return t;if(!t)return"";r=t.m,s=[];for(e in t)t.hasOwnProperty(e)&&"m"!==e&&t[e]>0&&(n?s.push(", variation "+t[e]+" at move "+e):s.push("-"+e+":"+t[e]));return r+=s.join("")},s=function(t){var e;return"object"==typeof t&&(t=i(t)),t?(e=t.split("-"),r={m:Number(e.shift())},e.length&&e.forEach(function(t,e){t=t.split(":"),r[Number(t[0])]=t[1]}),r):{m:0}},"undefined"==typeof e&&(e="string"==typeof t?"object":"string"),r="string"===e?i(t):"object"===e?s(t):void 0}},new e}}.call(this);